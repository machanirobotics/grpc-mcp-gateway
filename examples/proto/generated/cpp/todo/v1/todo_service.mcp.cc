// Code generated by protoc-gen-mcp. DO NOT EDIT.
// versions:
// 	protoc-gen-mcp v1.4.1-0.20260225155147-715b1d29db15+dirty
// Authors: Machani Robotics - Open Source 2026
// source: todo/v1/todo_service.proto

#include "todo/v1/todo_service.mcp.h"

#include <grpcpp/grpcpp.h>
#include <google/protobuf/util/json_util.h>

namespace todo { namespace v1 {

static std::string _mcp_error_json(const std::string& msg) {
    std::string escaped;
    escaped.reserve(msg.size());
    for (char c : msg) {
        if (c == '"') escaped += "\\\"";
        else if (c == '\\') escaped += "\\\\";
        else if (c == '\n') escaped += "\\n";
        else escaped += c;
    }
    return "{\"error\":\"" + escaped + "\"}";
}

static std::string _mcp_msg_to_json(const ::google::protobuf::Message& msg) {
    std::string json;
    ::google::protobuf::util::JsonPrintOptions opts;
    opts.preserve_proto_field_names = true;
    auto st = ::google::protobuf::util::MessageToJsonString(msg, &json, opts);
    if (!st.ok()) return _mcp_error_json(std::string(st.message()));
    return json;
}

TodoServiceMcpImpl::TodoServiceMcpImpl(std::shared_ptr<TodoService::Stub> stub)
    : stub_(std::move(stub)) {}

rust::String TodoServiceMcpImpl::create_todo(rust::Str args_json) const {
    std::string json(args_json.data(), args_json.size());
    CreateTodoRequest req;
    auto parse_st = ::google::protobuf::util::JsonStringToMessage(json, &req);
    if (!parse_st.ok())
        return rust::String(_mcp_error_json(std::string(parse_st.message())));
    ::grpc::ClientContext ctx;
    Todo resp;
    auto st = stub_->CreateTodo(&ctx, req, &resp);
    if (!st.ok())
        return rust::String(_mcp_error_json(st.error_message()));
    return rust::String(_mcp_msg_to_json(resp));
}

rust::String TodoServiceMcpImpl::delete_todo(rust::Str args_json) const {
    std::string json(args_json.data(), args_json.size());
    DeleteTodoRequest req;
    auto parse_st = ::google::protobuf::util::JsonStringToMessage(json, &req);
    if (!parse_st.ok())
        return rust::String(_mcp_error_json(std::string(parse_st.message())));
    ::grpc::ClientContext ctx;
    ::google::protobuf::Empty resp;
    auto st = stub_->DeleteTodo(&ctx, req, &resp);
    if (!st.ok())
        return rust::String(_mcp_error_json(st.error_message()));
    return rust::String(_mcp_msg_to_json(resp));
}

rust::String TodoServiceMcpImpl::get_todo(rust::Str args_json) const {
    std::string json(args_json.data(), args_json.size());
    GetTodoRequest req;
    auto parse_st = ::google::protobuf::util::JsonStringToMessage(json, &req);
    if (!parse_st.ok())
        return rust::String(_mcp_error_json(std::string(parse_st.message())));
    ::grpc::ClientContext ctx;
    Todo resp;
    auto st = stub_->GetTodo(&ctx, req, &resp);
    if (!st.ok())
        return rust::String(_mcp_error_json(st.error_message()));
    return rust::String(_mcp_msg_to_json(resp));
}

rust::String TodoServiceMcpImpl::list_todos(rust::Str args_json) const {
    std::string json(args_json.data(), args_json.size());
    ListTodosRequest req;
    auto parse_st = ::google::protobuf::util::JsonStringToMessage(json, &req);
    if (!parse_st.ok())
        return rust::String(_mcp_error_json(std::string(parse_st.message())));
    ::grpc::ClientContext ctx;
    ListTodosResponse resp;
    auto st = stub_->ListTodos(&ctx, req, &resp);
    if (!st.ok())
        return rust::String(_mcp_error_json(st.error_message()));
    return rust::String(_mcp_msg_to_json(resp));
}

rust::String TodoServiceMcpImpl::update_todo(rust::Str args_json) const {
    std::string json(args_json.data(), args_json.size());
    UpdateTodoRequest req;
    auto parse_st = ::google::protobuf::util::JsonStringToMessage(json, &req);
    if (!parse_st.ok())
        return rust::String(_mcp_error_json(std::string(parse_st.message())));
    ::grpc::ClientContext ctx;
    Todo resp;
    auto st = stub_->UpdateTodo(&ctx, req, &resp);
    if (!st.ok())
        return rust::String(_mcp_error_json(st.error_message()));
    return rust::String(_mcp_msg_to_json(resp));
}

std::unique_ptr<TodoServiceMcpImpl> new_todo_service_mcp() {
    auto channel = ::grpc::CreateChannel(
        "localhost:50051", ::grpc::InsecureChannelCredentials());
    auto stub = TodoService::NewStub(channel);
    return std::make_unique<TodoServiceMcpImpl>(std::move(stub));
}

} } // namespace todo::v1
